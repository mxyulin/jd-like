# SPH-总结和遇到的坑

## 技巧总结

- [开发套路]:
  1. 先写静态页面。
  2. 静态页面拆分成静态组件。
  3. 新增路由，API 发请求。
  4. vuex 三连发。
  5. 组件获取仓库数据，动态展示数据。
  6. 组件功能：筛选、排序、面包屑、上传、下载等等
- [性能优化]只需要请求**一次**的数据，请求放在`App`组件里发。
- [性能优化]需要**复用**的组件请求数据，放在父组件里发送该请求，因为子组件要复用，父组件替它拿到数据后`v-for`遍历数据复用子组件。数据可以通过`props`传递。复用可以节省资源开支。
- [减少代码]`vuex`的`getters`配置项的最佳使用场景：请求服务器返回的数据里面**层级过多**时，可以通过`getters`提前写好计算属性方便所有组件享用。
- [减少代码]请求参数键名一定要和服务器接收参数键名保持一致。
- [性能优化]请求参数默认值设置为`undefined`可以保证，参数为空时，请求不会携带该参数，节省网络带宽。
- [逻辑优化]项目中组件使用频繁的数据就放在它自身`data`即可，不要放在`vuex`
- [前端必须掌握]轮播图、分页器、日历。
- [知识点回顾]`v-if`是“真正”的条件渲染，因为它会确保在切换过程中条件块内的事件监听器和子组件适当地被销毁和重建。相比之下，`v-show`就简单得多——不管初始条件是什么，元素总是会被渲染，并且只是简单地基于 CSS 进行切换。
  - [延申知识点]`vuex`里如果拿`state`或者`getters`里的数据报错，就有可能是其初始值是`undefined`。所以需要`返回值 || {}`这种方式默认返回非`undefined`值。
- [项目工具]: `utils`文件夹一个专属于项目的**功能工具模块**，常放置身份验证、正则表达式、临时身份等功能性脚本模块。
- [经验之谈]数组统计，使用场景：数组内部的值做运算得到最终结果。举例：购物车结算总价。
- [经验之谈]节流器和防抖器内写匿名函数，不是箭头函数
- [经验之谈]异步请求一定要用`async..await`去控制异步请求，当数据拿到后才会通知组件渲染数据。
- [经验之谈] CSS 使用快捷路径`@/`需要加上`~`，也就是`~@/`。
- [趣味知识]手机验证码是公司买运营商的短信验证服务，后端老哥通过服务商提供的接口编辑短信信息，提供用户号码。按理来讲是获取验证码的这个接口，把验证码返回。但是正常情况，后台把验证码发到用户手机上。
- [心得体会]前端做的交互界面，实质上是帮助用户和服务器数据通信，做的一层缓冲和一架桥梁。本质目的是帮助用户便捷的发送数据（通过请求发送各种用户操作数据），帮助服务器直观、美观的展示数据，帮助服务器认识用户。
- [经验之谈]搜索历史放`locoStorage`中最佳。
- [减少代码]如果不通过`vuex`发请求，那么可以通过全局。
- [心得体会]`promise`是非常棒的异步处理技术，尤其是对API请求操作来说，简直就是福音。只需简单的链式调用就可以完成多个关联异步操作，并且一旦某个环节失败就立马被`catch`捕获，进入失败处理程序。
- [经验之谈]每个路由都有同的样验证行为，那么就可以将该验证行为写到**全局前置路由守卫**中。

## 项目遇到的坑

- [已解决问题]三级分类列表跳转搜索页时，由于结构刚渲染出来用户点击分类选项，导致路由携带的 query 参数为空。
  - [问题原因所在]**事件委托**导致所有被点击的子元素都会触发`@click`的回调，除了`<a>`其他元素是没有设置**自定义属性**的，所以触发事件调用回调时`e.target.dataset`根本就拿不到数据。---2022 年 10 月 03 日 22:33:59
  - [解决办法]利用自定义属性的有无判定是否`<a>`元素触发的点击事件。代码：`if (!e.target.dataset.cname) return;`。---2022 年 10 月 03 日 22:47:42
- [已解决问题]通过路由`$route`来触发`watch`监听是可以的，但和`$route`普通对象不一样。`$route`对象只可读，但要想通过修改`$route`对象的属性来触发`watch`，就自能通过`$router.push()`方法携带一个新的`location`对象。
- [已解决问题]用`Object.assign()`或者`{ ...obj }`进行浅复制后，和初始对象就完全**没有引用关系**了。也就是说，你不能用浅复制进行响应式数据的绑定。
  - [严重警告！！！]: `$route`不可写入，不能随便引用他。若要使用它的参数请浅复制。
  - [严重警告！！！]: 路由`params`要增加参数，必须提前在路由里新增占位符接收。
- [已解决问题]watch 监听不到`$route`中的 query 对象中数组参数的改变，因为数组必须靠`arr.push`, `arr.pop`去触发`watch`的监听。可惜`$route`对象只读，不可能用数组方法去修改`$route`对象。这基本无解，只能选择其他办法。
  - [解决办法]**欺骗数据**`query: {...this.bread.query, liar: Math.random() + Math.random()}`加了两个随机数，欺骗 watch 让它给爷重新更新路由发请求 。不知道工作中这么做会不会被打(狗头)
- [已解决问题]拿`vuex`中库的数据，如果报错数据`undefined`。那么多半是渲染时就读取了该数据，并且是异步请求拿的该数据。所以该数据在`beforeMount`阶段（渲染）初始值为空或`undefined`。
  - 解决办法：如果是直接访问`props`对象上的数据，层层传递时每层级的数据用用**或运算符**给个初始值。
  - 提示：另外如果是使用`v-if`, `v-for`访问`props`对象上的数据，那么无需层层指定初始值，因为`v-if`, `v-for`会等待真正的数据返回时才开始工作。所以不会出现该问题。
- `actions`内的回调只接收一个参数或对象（多个参数）进行传参。所以多个参数可以用解构赋值传参，接参。
- [已解决问题]编程式路由`a`标签里面不要写`href="#"`否则会把你的路由重置得一干二净。
- 脚手架配置`const { defineConfig } = require('@vue/cli-service')`用于vite，而不是vue-cli。
- [已解决问题]VSCode通过jsconfig.json设置Webpack别名失效
  - 是因为项目创建之初脚手架创建在 app-review 中，而项目初始化的是 app 文件夹。所以导致了项目根目录有冲突？
  - 解决办法，去掉 app 文件夹即可。
